getwd()
list.files()
library(tidyverse)
library(dplyr)
library(ggplot2)
library(maps)
library(class)
library(class)
library(caret)
library(e1071)
library(knitr)
install.packages("dplyr")
install.packages("class")
install.packages("caret")
install.packages("e1071")

#import data
beers <- read.csv ("beers.csv",  header= TRUE)
breweries <- read.csv("breweries.csv", header= TRUE)


#1 Breweries per State
BrewsPerState <- breweries %>% group_by(State) %>% count(State)
#Colorado had the most breweries, followed by California, then Missouri
#DC, ND, South Dakota, and West Virginia all have 1 brewery

#1- Sorted by amount of breweries
BrewsPerState %>% ggplot(aes(x=reorder(State, -n),y=n)) + geom_bar(stat = "identity") +
  ggtitle( "Number of Breweries per State") + xlab("State") + ylab("Number of Breweries") +
  geom_text(aes(label = signif(n, digits = 2)), nudge_y = 2)  + theme_solarized()

#2 Merge Data, merging on Brew_ID, we had to change the excel file to Brew_ID on one CSV

mergeDF = inner_join(beers,breweries, by = ("Brew_ID"))
head(mergeDF)
mergeDF <- dplyr::rename(mergeDF,BreweryName = Name.y)
mergeDF <- dplyr::rename(mergeDF,NameofBeer = Name.x)

#3 Drop all na values from merged dataset
mergeDF <- na.omit(mergeDF)
head(mergeDF)

#4 plot median abv and ibu with bar plot
#make two DF's
mergeDFABV <- mergeDF
mergeDFIBU <- mergeDF

#Calculate Median ABV
median(mergeDFABV$ABV, na.rm = TRUE)
MedianABV <- aggregate(ABV~State,mergeDFABV, FUN = median)
#Plot Median ABV
MedianABV %>% ggplot(aes(x = State, y = ABV)) + geom_bar(stat = "identity") + ggtitle("Median ABV by State") + xlab("State") + ylab("Median ABV")

#Calculate Median IBU
median(mergeDFIBU$IBU, na.rm = TRUE)
MedianIBU <- aggregate(IBU~State,mergeDFIBU, FUN = median)
#Plot Median IBU
MedianIBU %>% ggplot(aes(x = State, y = IBU)) + geom_bar(stat = "identity") + ggtitle("Median IBU by State") + xlab("State") + ylab("Median IBU")


#5 Find the Max ABV and IBU

#Calculate Max ABV
Max(merge(mergeDFABV$ABV, na.rm = TRUE))
max <- aggregate(ABV~State,mergeDFABV, FUN = max)

#Plot Max ABV
max_ABV %>% ggplot(aes(x = State, y = IBU)) + geom_bar(stat = "identity") + ggtitle("Max IBU by State") + xlab("State") + ylab("Max ABV") + geom_text(aes(label = signif(IBU, digits = 3)), nudge_y = 5) + theme_solarized()

#Caclulate Max IBU
max(mergeDFIBU$IBU, na.rm = TRUE)
maxIBU <- aggregate(IBU~State,mergeDFIBU, FUN = max)
#Plot Max IBU
maxIBU$ABV %>% ggplot(aes(x = reorder(State, -IBU), y = IBU)) + geom_bar(stat = "identity") + ggtitle("Max IBU by State") + xlab("State") + ylab("Max IBU") + 
  geom_text(aes(label = signif(ABV, digits = 2)), nudge_y = .003) + theme_solarized()

#6 Summary of ABV 
summary(mergeDFABV$ABV)
boxplot(mergeDFABV$ABV, xlab = "ABV Count From All the States", main ="Boxplot of ABV Data Summary", horizontal=TRUE, col='darkred')
#the average ABV is between 5.9% and 6% 

#7 Relationship between bitterness and ABV
#By state, not used
mergeDF %>% ggplot(aes(x = ABV, y = IBU)) + geom_point() + geom_smooth(method = "loess") + facet_wrap(~State)
#line of best fit
mergeDF %>% ggplot(mapping = aes(IBU,ABV), fill = "Style") + geom_point() + geom_smooth(method = "gam") + theme_solarized()


#8 KNN

#get IPA and Ale strings
NameGame <- filter(mergeDF, grepl('IPA|Ale', Style))

testname <- NameGame


#KNN
knn(NameGame[,3:4],testname, NameGame$Style, prob = TRUE, k = 5)
IPA_Ale = filter(mergeDF, grepl('IPA|Ale', Style))
#  only IPA, Ale, Style
IPA_Ale = select(IPA_Ale,ABV,IBU,Style)
set.seed(20)
splitPerc = 0.7
trainIndices = sample(1:dim(IPA_Ale)[1], round(splitPerc * dim(IPA_Ale)[1]))
train = IPA_Ale[splitPerc,]
test = IPA_Ale[-splitPerc,]
classifications = knn(train[,c(1:2)], test[,c(1:2)], train$Style, prob = TRUE, k = 10)
table(classifications, test$Style)
#set up confusion matrix
CM = confusionMatrix(table(classifications, test$Style))
CM

#9 Set up an EDA
mergeDF %>% ggplot(aes(x = State, y = ABV)) + geom_bin2d() + theme_classic()

theme_set(theme_bw())  
mergeDF %>% ggplot(aes(x = State, y = ABV,color=State)) + geom_count(show.legend = FALSE)
